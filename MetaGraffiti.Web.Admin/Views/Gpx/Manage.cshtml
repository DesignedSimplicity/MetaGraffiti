@using MetaGraffiti.Web.Admin.Models;
@model GpxViewModel

@Html.Partial("_Nav")

<script src="https://maps.googleapis.com/maps/api/js?key=@(AutoConfig.GoogleMapsApiKey)"></script>
<script src="~/Scripts/_graffiti/googleMaps.js"></script>
<script>
	var _colors = [
		'#007bff',
		'#28a745',
		'#17a2b8',
		'#ffc107',
		'#dc3545',

		'#b8daff',
		'#c3e6cb',
		'#bee5eb',
		'#ffeeba',
		'#f5c6cb',
	];

	var _marker = null;
	var _tracks = [
	@foreach (var t in Model.Tracks)
	{
<text>
		{
			track: '@t.Name',
			points: [
</text>
		foreach (var p in t.Points)
		{
<text>
				{ lat: @p.Latitude, lng: @p.Longitude },
</text>
		}
<text>
			]
		},
</text>
	}
		];

	$(document).ready(function () {
		initMap();
		loadTrack();
	});

	function loadTrack() {
		@for (var i = 0; i < Model.Tracks.Count; i++)
		{
<text>
		var color = _colors[@(i % 10)];
		showTrack(_tracks[@(i)].points, color);
		$("table > tbody > tr").eq(@(i)).children().eq(0).css('background-color', color);
</text>
		}
	}
</script>

<div id="map-container">
	<div id="map">
	</div>
</div>

<div class="row">
	<div class="col-sm-6">
		<table class="table table-striped table-sm">
			<thead class="thead-dark">
				<tr>
					<th class="text-center">#</th>
					<th>Start</th>
					<th>Finish</th>
					<th>Track Name</th>
					<th>Description</th>
					<th>Source</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				@{
					var count = 0;
					foreach (var track in Model.Tracks.OrderBy(x => x.Points.First().Timestamp))
					{
						<tr>
							<td class="text-center">@(++count)</td>
							<td>@track.StartTime.ToString("yyyy-MM-dd")<br />@track.StartTime.ToString("hh:mm:ss tt")</td>
							<td>@track.FinishTime.ToString("yyyy-MM-dd")<br />@track.FinishTime.ToString("hh:mm:ss tt")</td>
							<td class="font-weight-bold">@track.Name</td>
							<td class="small">@track.Description</td>
							<td><a href="@GpxViewModel.GetDisplayUrl(track.Source.Uri)">@track.Source.Name</a></td>
							<td><a class="btn btn-sm btn-outline-danger" href="@GpxViewModel.GetRemoveTrackUrl(track.ID)">Remove</a></td>
						</tr>
					}
				}
			</tbody>
		</table>
	</div>
</div>