@using MetaGraffiti.Web.Admin.Models;
@model CartoPlaceFormModel
@{
	var place = Model.Place;
}

<script>
	var _place = @JsonHelper.GetJson(place);
	var _marker = null;
	var _bounds = null;

	$(document).ready(function () {
		initMap();

		_marker = dragPoint(_place.center.lat, _place.center.lng, _place.name);
		_marker.addListener('dragend', updateCenter);

		_bounds = editBounds(_place.bounds, null, '');
		_bounds.addListener('bounds_changed', updateBounds);

		function updateCenter() {
			var c = _marker.getPosition();
			$("#CenterLatitude").val(c.lat());
			$("#CenterLongitude").val(c.lng());
		}

		function updateBounds() {
			var ne = _bounds.getBounds().getNorthEast();
			var sw = _bounds.getBounds().getSouthWest();

			$("#NorthLatitude").val(ne.lat());
			$("#WestLongitude").val(sw.lng());
			$("#SouthLatitude").val(sw.lat());
			$("#EastLongitude").val(ne.lng());
		}

		$(".js-google-key").click(function () {
			$("#GoogleKey").val("");
			$("#GoogleKeyDisplay").val("");
		});

		$(".js-region-lookup").click(function () {
			$("#Region").val("...").addClass("is-invalid").removeClass("is-valid");
			geocodeRegion();
		});

		function geocodeRegion() {
			$.getJSON('/api/regions/point/?lat=' + _place.center.lat + "&lng=" + _place.center.lng)
				.done(function (data) {
					$("#Region").val(data.RegionName).addClass("is-valid").removeClass("is-invalid");
				})
				.fail(function (jqXHR, textStatus, err) {
					$("#Region").val('').addClass("is-invalid").removeClass("is-valid");
				});
		}
	});
</script>

<div class="row">
	<div class="col">
		<div class="form-group">
			<label for="Name">Name</label>
			<input type="text" class="form-control" name="Name" value="@place.Name">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="LocalName">Local Name</label>
			<input type="text" class="form-control" name="LocalName" value="@place.LocalName">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="DisplayAs">Display As</label>
			<input type="text" class="form-control" name="DisplayAs" value="@place.DisplayAs">
		</div>
	</div>
</div>
<div class="row">
	<div class="col">
		<div class="form-group">
			<label for="Description">Description</label>
			<div class="input-group">
				<input type="text" class="form-control" name="Description" value="@place.Description">
				<div class="input-group-append">
					<a target="_blank" class="btn btn-outline-info" href="http://www.google.com/search?q=@("wiki " + Model.Place.Name + " " + Model.Place.Country)&btnI">Wikipedia</a>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col">
		<div class="form-group">
			<label for="PlaceType">Place Type</label>
			<input type="text" class="form-control" name="PlaceType" value="@place.PlaceType">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="PlaceFlags">Flags</label>
			<input type="text" class="form-control" disabled name="PlaceFlags" value="">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="IconKey">Icon</label>
			<input type="text" class="form-control" disabled name="IconKey" value="">
		</div>
	</div>
</div>

<hr />
<div class="row">
	<div class="col">
		<div class="form-group">
			<label for="Address">Address</label>
			<input type="text" class="form-control" name="Address" value="@place.Address">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="Locality">Locality</label>
			<input type="text" class="form-control" name="Locality" value="@place.Locality">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="Postcode">Postcode</label>
			<input type="text" class="form-control" name="Postcode" value="@place.Postcode">
		</div>
	</div>
</div>
<div class="row">
	<div class="col">
		<div class="form-group">
			<label for="Country">Country</label>
			<input type="text" name="Country" class="form-control  @(place.Country == null ? "is-invalid" : "is-valid")" value="@(place.Country?.Name??"")">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="Subregions">Subregions</label>
			<input type="hidden" name="Subregions" value="@place.Subregions">
			<input type="text" class="form-control" readonly value="@place.Subregions">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="Region">Region</label>
			<div class="input-group">
				<input type="text" class="form-control @(place.Region == null ? "is-invalid" : "is-valid")" id="Region" name="Region" value="@(place.Region?.RegionName ?? "")">
				<div class="input-group-append">
					<button class="btn btn-outline-secondary js-region-lookup" type="button">Lookup</button>
				</div>
			</div>
		</div>
	</div>
</div>
<hr />
<div class="row">
	<div class="col">
		<div class="form-group">
			<label for="PlaceKey">Place Key</label>
			<input type="hidden" name="PlaceKey" value="@(Model.IsPreview ? "" : place.Key)">
			<input type="text" class="form-control" readonly value="@(Model.IsPreview ? "" : place.Key)">
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="NorthLatitude">North West</label>
			<div class="input-group">
				<input type="text" class="form-control" name="NorthLatitude" id="NorthLatitude" placeholder="Latitude" value="@(place.Bounds.NorthWest.Latitude.ToString("0.0000000000"))">
				<input type="text" class="form-control" name="WestLongitude" id="WestLongitude" placeholder="Longitude" value="@(place.Bounds.NorthWest.Longitude.ToString("0.0000000000"))">
			</div>
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="CenterLatitude">Center</label>
			<div class="input-group">
				<input type="text" class="form-control" name="CenterLatitude" id="CenterLatitude" placeholder="Latitude" value="@place.Center.Latitude.ToString("0.0000000000")">
				<input type="text" class="form-control" name="CenterLongitude" id="CenterLongitude" placeholder="Longitude" value="@place.Center.Longitude.ToString("0.0000000000")">
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col">
		<div class="form-group">
			<label for="GoogleKey">Google Key</label>
			<input type="hidden" name="GoogleKey" id="GoogleKey" value="@place.GoogleKey">
			<div class="input-group">
				<input type="text" class="form-control" id="GoogleKeyDisplay" readonly value="@place.GoogleKey">
				<div class="input-group-append">
					<button class="btn btn-outline-danger js-google-key" type="button">Remove</button>
				</div>
			</div>
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="SouthLatitude">South East</label>
			<div class="input-group">
				<input type="text" class="form-control" name="SouthLatitude" id="SouthLatitude" placeholder="Latitude" value="@(place.Bounds.SouthEast.Latitude.ToString("0.0000000000"))">
				<input type="text" class="form-control" name="EastLongitude" id="EastLongitude" placeholder="Longitude" value="@(place.Bounds.SouthEast.Longitude.ToString("0.0000000000"))">
			</div>
		</div>
	</div>
	<div class="col">
		<div class="form-group">
			<label for="TimezoneKey">Timezone</label>
			<div class="input-group">
				<input type="text" class="form-control" name="Timezone" value="">
				<div class="input-group-append">
					<button class="btn btn-outline-secondary" disabled type="button">Lookup</button>
				</div>
			</div>
		</div>
	</div>
</div>