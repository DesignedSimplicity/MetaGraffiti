@using MetaGraffiti.Web.Admin.Models;
@model PlaceViewModel

@Html.Partial("_Nav")

@{
	var place = Model.PreviewPlace;
}


<script src="https://maps.googleapis.com/maps/api/js?key=@(AutoConfig.GoogleMapsApiKey)"></script>
<script src="~/Scripts/_graffiti/googleMaps.js"></script>
<script>
	var _place = @Model.GetPlaceJson(place);

	$(document).ready(function () {
		initMap();

		_place.marker = markPoint(_place.center.lat, _place.center.lng, _place.name);

		drawBounds(_place.bounds, null, '');

		fitBounds(_place.bounds);

		$('#Region').change(function () {
			$('#Region').addClass("is-invalid");
		});
		$(".js-region-lookup").click(function () {
			var id = $('#Region').val();

			$.getJSON('/api/regions/' + id)
				.done(function (data) {
					$('#Region').text(data.RegionName);
					$('#Region').removeClass("is-invalid");
					$('#Region').addClass("is-valid");
				})
				.fail(function (jqXHR, textStatus, err) {
					$('#Region').addClass("is-invalid");
				});
		});
	});
</script>

<div id="map-container">
	<div id="map">
	</div>
</div>

<div class="row">
	<div class="col-sm-6">
		<div class="h2">
			Place<span class="h3">: @place.Name</span>
		</div>
		<br />
		<form method="post" action="/carto/location/">
			<input type="hidden" name="ID" value="@place.Key" />

			<div class="row">
				<div class="col">
					<div class="form-group">
						<label for="Name">Name</label>
						<input type="text" class="form-control" name="Name" value="@place.Name">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="LocalName">Local Name</label>
						<input type="text" class="form-control" name="LocalName" value="@place.LocalName">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="DisplayAs">Display As</label>
						<input type="text" class="form-control" name="DisplayAs" value="@place.DisplayAs">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="form-group">
						<label for="Description">Description</label>
						<input type="text" class="form-control" name="Description" value="@place.Description">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="form-group">
						<label for="PlaceType">Place Type</label>
						<input type="text" class="form-control" name="PlaceType" value="@place.PlaceType">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="PlaceFlags">Flags</label>
						<input type="text" disabled class="form-control" name="PlaceFlags" value="">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="IconKey">Icon</label>
						<input type="text" disabled class="form-control" name="IconKey" value="">
					</div>
				</div>
			</div>

			<hr />
			<div class="row">
				<div class="col">
					<div class="form-group">
						<label for="Address">Address</label>
						<input type="text" class="form-control" name="Address" value="@place.Address">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="Locality">Locality</label>
						<input type="text" class="form-control" name="Locality" value="@place.Locality">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="Postcode">Postcode</label>
						<input type="text" class="form-control" name="Postcode" value="@place.Postcode">
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="form-group">
						<label for="Country">Country</label>
						<input type="text" readonly class="form-control" name="Country" value="@place.Country.Name">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="Subregions">Subregions</label>
						<input type="text" disabled class="form-control" name="Subregions" value="@place.Subregions">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="Region">Region</label>
						<div class="input-group">
							<input type="text" class="form-control @(place.Region == null ? "is-invalid": "is-valid")" id="Region" name="Region" value="@(place.Region?.RegionName??"")">
							<div class="input-group-append">
								<button class="btn btn-outline-secondary js-region-lookup" type="button">Lookup</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<hr />
			<div class="row">
				<div class="col">
					<div class="form-group">
						<label for="CenterLatitude">Center</label>
						<div class="input-group">
							<input type="text" class="form-control" readonly name="CenterLatitude" placeholder="Latitude" value="@place.Center.Latitude">
							<input type="text" class="form-control" readonly name="CenterLongitude" placeholder="Longitude" value="@place.Center.Longitude">
						</div>
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="NorthLatitude">North West</label>
						<div class="input-group">
							<input type="text" class="form-control" readonly name="NorthLatitude" placeholder="Latitude" value="@(place.Bounds.NorthWest.Latitude)">
							<input type="text" class="form-control" readonly name="WestLongitude" placeholder="Longitude" value="@(place.Bounds.NorthWest.Longitude)">
						</div>
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="SouthLatitude">South East</label>
						<div class="input-group">
							<input type="text" class="form-control" readonly name="SouthLatitude" placeholder="Latitude" value="@(place.Bounds.SouthEast.Latitude)">
							<input type="text" class="form-control" readonly name="EastLongitude" placeholder="Longitude" value="@(place.Bounds.SouthEast.Longitude)">
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="form-group">
						<label for="PlaceKey">Place Key</label>
						<input type="hidden" name="PlaceKey" value="@place.Key">
						<input type="text" class="form-control" readonly name="PlaceKeyDisplay" value="@place.Key">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="GoogleKey">Google Key</label>
						<input type="hidden" name="GoogleKey" value="@place.GoogleKey">
						<input type="text" class="form-control" readonly name="GoogleKeyDisplay" value="@place.GoogleKey">
					</div>
				</div>
				<div class="col">
					<div class="form-group">
						<label for="TimezoneKey">Timezone</label>
						<div class="input-group">
							<input type="text" class="form-control" name="TimezoneKey" value="">
							<div class="input-group-append">
								<button class="btn btn-outline-secondary" type="button">Lookup</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<hr />
			<button class="btn btn-primary" type="submit">Update</button>
		</form>
	</div>
</div>